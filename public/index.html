<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Capture Basel</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <!-- TEMPORARILY DISABLED: ml5 hand tracking
    <script src="https://unpkg.com/ml5@1/dist/ml5.min.js"></script>
    -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/Draggable.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <!-- Left Sidebar -->
    <aside class="sidebar">
      <!-- Title -->
      <div class="app-title">
        <img
          src="title_logo_v2.jpg"
          alt="Basel Simplified"
          class="title-logo"
        />
      </div>

      <!-- Mode Switch -->
      <div class="section mode-switch-section">
        <div class="mode-switch-container">
          <button class="mode-switch-btn" data-mode="scene">Scene Mode</button>
          <button class="mode-switch-btn active" data-mode="grid">
            Grid Mode
          </button>
        </div>
      </div>

      <!-- Upload Section -->
      <div class="section upload-section">
        <label for="image-upload" class="upload-preview-combined">
          <input type="file" id="image-upload" accept="image/*" hidden />
          <img
            id="upload-preview"
            class="upload-preview"
            src="addimg.jpg"
            alt="Add Image"
          />
        </label>
      </div>

      <!-- Generate Button -->
      <div style="display: flex; gap: 8px">
        <img
          id="generate-btn"
          class="generate-btn"
          src="gen-button.jpg"
          style="flex: 1; cursor: pointer"
        />
      </div>

      <!-- Progress Section -->
      <div id="progress-container" class="section progress-section hidden">
        <div style="display: flex; align-items: center; gap: 8px">
          <img
            id="progress-image"
            class="progress-image"
            src="progressbar_1.jpg"
            alt="Progress"
            style="flex: 1; width: 100%; height: auto"
          />
          <button id="cancel-btn" class="cancel-btn">×</button>
        </div>
        <div id="progress-text" class="progress-text">Generating...</div>
        <div id="status-updates" class="status-updates"></div>
      </div>

      <!-- Quartiere Section -->
      <div class="section quartiere-section">
        <div id="quartiere-grid" class="quartiere-grid">
          <button class="quartier-toggle" data-quartier="1">
            <span class="quartier-name">Altstadt Grossbasel</span>
            <span class="quartier-count" data-count="1">0</span>
          </button>
          <button class="quartier-toggle" data-quartier="2">
            <span class="quartier-name">Altstadt Kleinbasel</span>
            <span class="quartier-count" data-count="2">0</span>
          </button>
          <button class="quartier-toggle" data-quartier="3">
            <span class="quartier-name">Vorstädte</span>
            <span class="quartier-count" data-count="3">0</span>
          </button>
          <button class="quartier-toggle" data-quartier="4">
            <span class="quartier-name">Am Ring</span>
            <span class="quartier-count" data-count="4">0</span>
          </button>
          <button class="quartier-toggle" data-quartier="5">
            <span class="quartier-name">Breite</span>
            <span class="quartier-count" data-count="5">0</span>
          </button>
          <button class="quartier-toggle" data-quartier="6">
            <span class="quartier-name">Gundeldingen</span>
            <span class="quartier-count" data-count="6">0</span>
          </button>
          <button class="quartier-toggle" data-quartier="7">
            <span class="quartier-name">St. Johann</span>
            <span class="quartier-count" data-count="7">0</span>
          </button>
          <button class="quartier-toggle" data-quartier="8">
            <span class="quartier-name">St. Alban</span>
            <span class="quartier-count" data-count="8">0</span>
          </button>
          <button class="quartier-toggle" data-quartier="9">
            <span class="quartier-name">Iselin</span>
            <span class="quartier-count" data-count="9">0</span>
          </button>
          <button class="quartier-toggle" data-quartier="10">
            <span class="quartier-name">Bruderholz</span>
            <span class="quartier-count" data-count="10">0</span>
          </button>
          <button class="quartier-toggle" data-quartier="11">
            <span class="quartier-name">Bachletten</span>
            <span class="quartier-count" data-count="11">0</span>
          </button>
          <button class="quartier-toggle" data-quartier="12">
            <span class="quartier-name">Gotthelf</span>
            <span class="quartier-count" data-count="12">0</span>
          </button>
          <button class="quartier-toggle" data-quartier="13">
            <span class="quartier-name">Clara</span>
            <span class="quartier-count" data-count="13">0</span>
          </button>
          <button class="quartier-toggle" data-quartier="14">
            <span class="quartier-name">Wettstein</span>
            <span class="quartier-count" data-count="14">0</span>
          </button>
          <button class="quartier-toggle" data-quartier="15">
            <span class="quartier-name">Hirzbrunnen</span>
            <span class="quartier-count" data-count="15">0</span>
          </button>
          <button class="quartier-toggle" data-quartier="16">
            <span class="quartier-name">Rosental</span>
            <span class="quartier-count" data-count="16">0</span>
          </button>
          <button class="quartier-toggle" data-quartier="17">
            <span class="quartier-name">Matthäus</span>
            <span class="quartier-count" data-count="17">0</span>
          </button>
          <button class="quartier-toggle" data-quartier="18">
            <span class="quartier-name">Klybeck</span>
            <span class="quartier-count" data-count="18">0</span>
          </button>
          <button class="quartier-toggle" data-quartier="19">
            <span class="quartier-name">Kleinhüningen</span>
            <span class="quartier-count" data-count="19">0</span>
          </button>
          <button class="quartier-toggle" data-quartier="20">
            <span class="quartier-name">Ausserhalb</span>
            <span class="quartier-count" data-count="20">0</span>
          </button>
        </div>
      </div>

      <!-- QR Code Section -->
      <div class="section qr-section">
        <svg
          class="qr-code"
          shape-rendering="geometricPrecision"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 29 29"
        >
          <path
            d="M10 2h1v1h-1zM12 2h1v1h-1zM14 2h1v1h-1zM15 2h1v1h-1zM16 2h1v1h-1zM17 2h1v1h-1zM10 3h1v1h-1zM12 3h1v1h-1zM15 3h1v1h-1zM18 3h1v1h-1zM10 4h1v1h-1zM11 4h1v1h-1zM13 4h1v1h-1zM15 4h1v1h-1zM16 4h1v1h-1zM12 5h1v1h-1zM17 5h1v1h-1zM18 5h1v1h-1zM10 6h1v1h-1zM11 6h1v1h-1zM14 6h1v1h-1zM16 6h1v1h-1zM15 7h1v1h-1zM10 8h1v1h-1zM12 8h1v1h-1zM14 8h1v1h-1zM16 8h1v1h-1zM18 8h1v1h-1zM11 9h1v1h-1zM12 9h1v1h-1zM15 9h1v1h-1zM17 9h1v1h-1zM18 9h1v1h-1zM2 10h1v1h-1zM5 10h1v1h-1zM6 10h1v1h-1zM7 10h1v1h-1zM8 10h1v1h-1zM9 10h1v1h-1zM10 10h1v1h-1zM11 10h1v1h-1zM12 10h1v1h-1zM14 10h1v1h-1zM16 10h1v1h-1zM17 10h1v1h-1zM18 10h1v1h-1zM19 10h1v1h-1zM22 10h1v1h-1zM24 10h1v1h-1zM25 10h1v1h-1zM26 10h1v1h-1zM3 11h1v1h-1zM4 11h1v1h-1zM7 11h1v1h-1zM11 11h1v1h-1zM12 11h1v1h-1zM17 11h1v1h-1zM19 11h1v1h-1zM21 11h1v1h-1zM22 11h1v1h-1zM23 11h1v1h-1zM24 11h1v1h-1zM25 11h1v1h-1zM3 12h1v1h-1zM4 12h1v1h-1zM5 12h1v1h-1zM7 12h1v1h-1zM8 12h1v1h-1zM9 12h1v1h-1zM10 12h1v1h-1zM11 12h1v1h-1zM13 12h1v1h-1zM14 12h1v1h-1zM17 12h1v1h-1zM19 12h1v1h-1zM20 12h1v1h-1zM21 12h1v1h-1zM22 12h1v1h-1zM23 12h1v1h-1zM26 12h1v1h-1zM2 13h1v1h-1zM3 13h1v1h-1zM4 13h1v1h-1zM5 13h1v1h-1zM6 13h1v1h-1zM7 13h1v1h-1zM10 13h1v1h-1zM11 13h1v1h-1zM12 13h1v1h-1zM14 13h1v1h-1zM17 13h1v1h-1zM18 13h1v1h-1zM19 13h1v1h-1zM23 13h1v1h-1zM24 13h1v1h-1zM25 13h1v1h-1zM26 13h1v1h-1zM6 14h1v1h-1zM8 14h1v1h-1zM9 14h1v1h-1zM10 14h1v1h-1zM12 14h1v1h-1zM14 14h1v1h-1zM15 14h1v1h-1zM17 14h1v1h-1zM20 14h1v1h-1zM26 14h1v1h-1zM2 15h1v1h-1zM4 15h1v1h-1zM6 15h1v1h-1zM9 15h1v1h-1zM15 15h1v1h-1zM17 15h1v1h-1zM18 15h1v1h-1zM19 15h1v1h-1zM22 15h1v1h-1zM25 15h1v1h-1zM2 16h1v1h-1zM3 16h1v1h-1zM4 16h1v1h-1zM5 16h1v1h-1zM6 16h1v1h-1zM7 16h1v1h-1zM8 16h1v1h-1zM9 16h1v1h-1zM10 16h1v1h-1zM11 16h1v1h-1zM12 16h1v1h-1zM13 16h1v1h-1zM14 16h1v1h-1zM16 16h1v1h-1zM17 16h1v1h-1zM19 16h1v1h-1zM20 16h1v1h-1zM22 16h1v1h-1zM23 16h1v1h-1zM24 16h1v1h-1zM25 16h1v1h-1zM26 16h1v1h-1zM2 17h1v1h-1zM9 17h1v1h-1zM10 17h1v1h-1zM12 17h1v1h-1zM13 17h1v1h-1zM17 17h1v1h-1zM20 17h1v1h-1zM21 17h1v1h-1zM23 17h1v1h-1zM24 17h1v1h-1zM26 17h1v1h-1zM2 18h1v1h-1zM4 18h1v1h-1zM5 18h1v1h-1zM8 18h1v1h-1zM9 18h1v1h-1zM10 18h1v1h-1zM11 18h1v1h-1zM15 18h1v1h-1zM18 18h1v1h-1zM19 18h1v1h-1zM20 18h1v1h-1zM21 18h1v1h-1zM22 18h1v1h-1zM24 18h1v1h-1zM25 18h1v1h-1zM10 19h1v1h-1zM12 19h1v1h-1zM13 19h1v1h-1zM14 19h1v1h-1zM15 19h1v1h-1zM18 19h1v1h-1zM22 19h1v1h-1zM24 19h1v1h-1zM25 19h1v1h-1zM10 20h1v1h-1zM12 20h1v1h-1zM13 20h1v1h-1zM18 20h1v1h-1zM20 20h1v1h-1zM22 20h1v1h-1zM26 20h1v1h-1zM10 21h1v1h-1zM12 21h1v1h-1zM14 21h1v1h-1zM15 21h1v1h-1zM17 21h1v1h-1zM18 21h1v1h-1zM22 21h1v1h-1zM25 21h1v1h-1zM10 22h1v1h-1zM12 22h1v1h-1zM14 22h1v1h-1zM15 22h1v1h-1zM16 22h1v1h-1zM17 22h1v1h-1zM18 22h1v1h-1zM19 22h1v1h-1zM20 22h1v1h-1zM21 22h1v1h-1zM22 22h1v1h-1zM25 22h1v1h-1zM26 22h1v1h-1zM10 23h1v1h-1zM11 23h1v1h-1zM12 23h1v1h-1zM16 23h1v1h-1zM19 23h1v1h-1zM20 23h1v1h-1zM25 23h1v1h-1zM26 23h1v1h-1zM12 24h1v1h-1zM14 24h1v1h-1zM15 24h1v1h-1zM18 24h1v1h-1zM19 24h1v1h-1zM22 24h1v1h-1zM23 24h1v1h-1zM24 24h1v1h-1zM25 24h1v1h-1zM26 24h1v1h-1zM12 25h1v1h-1zM16 25h1v1h-1zM21 25h1v1h-1zM22 25h1v1h-1zM24 25h1v1h-1zM25 25h1v1h-1zM26 25h1v1h-1zM10 26h1v1h-1zM11 26h1v1h-1zM12 26h1v1h-1zM14 26h1v1h-1zM15 26h1v1h-1zM16 26h1v1h-1zM17 26h1v1h-1zM18 26h1v1h-1zM23 26h1v1h-1zM26 26h1v1h-1z"
          />
          <path d="M2 2h7.02v7.02H2zm1.17 1.17v4.68h4.68V3.17z" />
          <path d="M4 4h3v3H4z" />
          <path d="M2 20h7.02v7.02H2zm1.17 1.17v4.68h4.68v-4.68z" />
          <path d="M4 22h3v3H4z" />
          <path d="M20 2h7.02v7.02H20zm1.17 1.17v4.68h4.68V3.17z" />
          <path d="M22 4h3v3h-3z" />
        </svg>
      </div>

      <!-- Info Button -->
      <button id="info-btn" class="info-btn" aria-label="Project Information">
        i
      </button>
    </aside>

    <!-- Main Canvas Area -->
    <main class="main-canvas">
      <div id="result-container" class="result-container">
        <div class="placeholder">Generated images will appear here</div>
      </div>
    </main>

    <!-- Grid Container -->
    <div id="grid-container" class="grid-container"></div>

    <!-- TEMPORARILY DISABLED: Hand Tracking Camera
    <div id="p5-container"></div>
    -->

    <!-- Scene Control Buttons -->
    <div id="scene-controls" class="scene-controls">
      <button
        id="random-images-btn"
        class="scene-control-btn"
        title="Add 6 Random Images"
      >
        Random
      </button>
      <button
        id="normalize-size-btn"
        class="scene-control-btn"
        title="Make All Same Size"
      >
        Same Size
      </button>
    </div>

    <!-- Info Modal -->
    <div id="info-modal" class="info-modal hidden">
      <div class="info-modal-content">
        <button id="info-close-btn" class="info-close-btn">&times;</button>
        <div class="info-section">
          <p>
            Developed by <strong>Oliver Wick</strong> and
            <strong>Nicolas Birrer</strong><br />
            Mentored by <strong>Paulina Zybinska</strong>
          </p>
          <p>
            Hochschule für Kunst und Gestaltung Basel FHNW<br />
            Visual Communication and Digital Spaces B, 5. Semester
          </p>
        </div>
        <div class="info-section">
          <h3>AI Workflow</h3>
          <ol>
            <li>
              GPS-Daten (EXIF) von Bild extrahieren mit
              <strong>Google Geocoding API</strong>
            </li>
            <li>
              Identifizierung Hauptobjekt mit
              <strong>Google Gemini 2.0 Flash</strong> via Replicate API
            </li>
            <li>
              Fall AI: <strong>Segment Anything Model 3</strong> = Masking main
              object
            </li>
            <li>
              Img-Generation with <strong>Flux 2 Lora</strong> (trained with
              Illustrations from Oliver Wick)
            </li>
          </ol>
          <div class="info-image-container">
            <img
              src="original drawing.webp"
              alt="Training Data"
              class="info-image"
            />
            <p class="info-caption">
              Training data Flux Lora, Illustrations by Oliver Wick
            </p>
          </div>
        </div>
        <div class="info-section info-disclaimer">
          <h3>Datenschutz & Speicherung</h3>
          <p>
            Hochgeladene Bilder werden nur temporär verarbeitet und zur Analyse
            an Google Gemini und fal.ai weitergeleitet. Generierte Zeichnungen
            werden auf Cloudflare R2 gespeichert und sind öffentlich zugänglich.
          </p>
          <p>Bitte laden Sie keine sensiblen oder persönlichen Bilder hoch.</p>
        </div>
      </div>
    </div>

    <!-- Mobile Header -->
    <header id="mobile-header" class="mobile-header">
      <img
        src="title_logo_v2.jpg"
        alt="Capture Basel"
        class="mobile-title-logo"
      />
      <div class="mobile-header-buttons">
        <button
          id="mobile-grid-toggle"
          class="mobile-grid-toggle"
          title="Grid Layout"
        >
          <svg
            class="grid-icon-2col active"
            width="20"
            height="20"
            viewBox="0 0 20 20"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <rect x="2" y="2" width="7" height="7" fill="currentColor" />
            <rect x="11" y="2" width="7" height="7" fill="currentColor" />
            <rect x="2" y="11" width="7" height="7" fill="currentColor" />
            <rect x="11" y="11" width="7" height="7" fill="currentColor" />
          </svg>
          <svg
            class="grid-icon-4col"
            width="20"
            height="20"
            viewBox="0 0 20 20"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <rect x="2" y="2" width="3" height="3" fill="currentColor" />
            <rect x="6.5" y="2" width="3" height="3" fill="currentColor" />
            <rect x="11" y="2" width="3" height="3" fill="currentColor" />
            <rect x="15.5" y="2" width="3" height="3" fill="currentColor" />
            <rect x="2" y="6.5" width="3" height="3" fill="currentColor" />
            <rect x="6.5" y="6.5" width="3" height="3" fill="currentColor" />
            <rect x="11" y="6.5" width="3" height="3" fill="currentColor" />
            <rect x="15.5" y="6.5" width="3" height="3" fill="currentColor" />
            <rect x="2" y="11" width="3" height="3" fill="currentColor" />
            <rect x="6.5" y="11" width="3" height="3" fill="currentColor" />
            <rect x="11" y="11" width="3" height="3" fill="currentColor" />
            <rect x="15.5" y="11" width="3" height="3" fill="currentColor" />
            <rect x="2" y="15.5" width="3" height="3" fill="currentColor" />
            <rect x="6.5" y="15.5" width="3" height="3" fill="currentColor" />
            <rect x="11" y="15.5" width="3" height="3" fill="currentColor" />
            <rect x="15.5" y="15.5" width="3" height="3" fill="currentColor" />
          </svg>
        </button>
        <button id="mobile-info-btn" class="mobile-info-btn">i</button>
      </div>
    </header>

    <!-- Mobile Quartier Filter Chips -->
    <div id="mobile-quartier-chips" class="mobile-quartier-chips">
      <!-- Will be populated by JavaScript -->
    </div>

    <!-- Mobile Grid Container (separate from desktop) -->
    <div id="mobile-grid-container" class="mobile-grid-container"></div>

    <!-- Mobile Progress Bar (integrated in UI, above bottom bar) -->
    <div
      id="mobile-progress-bar-container"
      class="mobile-progress-bar-container"
    >
      <div class="mobile-progress-bar-inner">
        <div
          id="mobile-progress-bar-fill"
          class="mobile-progress-bar-fill"
        ></div>
      </div>
      <div id="mobile-progress-text-small" class="mobile-progress-text-small">
        Wird verarbeitet...
      </div>
    </div>

    <!-- Mobile Bottom Bar (Upload & Generate) -->
    <div id="mobile-bottom-bar" class="mobile-bottom-bar">
      <!-- Integrated Progress Bar (full width above buttons) -->
      <div id="mobile-bottom-progress" class="mobile-bottom-progress hidden">
        <img
          id="mobile-progress-image"
          class="mobile-progress-image"
          src="progressbar_1.jpg"
          alt="Progress"
        />
        <div
          id="mobile-bottom-progress-text"
          class="mobile-bottom-progress-text"
        >
          Wird verarbeitet...
        </div>
      </div>

      <!-- Buttons Row -->
      <div class="mobile-bottom-buttons">
        <!-- Upload Image Button -->
        <label
          for="mobile-image-upload"
          class="mobile-upload-label"
          id="mobile-upload-label"
        >
          <input type="file" id="mobile-image-upload" accept="image/*" hidden />
          <img
            id="mobile-upload-preview"
            class="mobile-upload-img"
            src="addimg.jpg"
            alt="Bild hinzufügen"
          />
        </label>

        <!-- Generate Button -->
        <img
          id="mobile-generate-btn"
          class="mobile-generate-btn"
          src="gen-button.jpg"
          alt="Generieren"
        />
      </div>
    </div>

    <!-- Mobile Progress Overlay -->
    <div id="mobile-progress-overlay" class="mobile-progress-overlay hidden">
      <div class="mobile-progress-content">
        <div class="mobile-progress-bar">
          <div id="mobile-progress-fill" class="mobile-progress-fill"></div>
        </div>
        <div id="mobile-progress-text" class="mobile-progress-text">
          Wird verarbeitet...
        </div>
        <button id="mobile-cancel-btn" class="mobile-cancel-btn">
          &times;
        </button>
      </div>
    </div>

    <!-- TEMPORARILY DISABLED: Hand Tracking Script
    <script>
      // Only load hand tracking on desktop (not mobile)
      if (window.innerWidth > 768) {
        const script = document.createElement("script");
        script.src = "handtracking.js";
        document.body.appendChild(script);
      }
    </script>
    -->
    <script src="app.js"></script>
  </body>
</html>
